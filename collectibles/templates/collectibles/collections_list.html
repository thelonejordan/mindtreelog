{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ current_meta.label }}</title>

    <!-- Base styles -->
    <link rel="stylesheet" href="{% static 'collectibles/css/base.css' %}">

    <!-- Collection-specific styles -->
    {% if collection_type == 'youtube' %}
    <link rel="stylesheet" href="{% static 'collectibles/css/youtube.css' %}">
    {% elif collection_type == 'twitter' %}
    <link rel="stylesheet" href="{% static 'collectibles/css/twitter.css' %}">
    {% elif collection_type == 'arxiv' %}
    <link rel="stylesheet" href="{% static 'collectibles/css/arxiv.css' %}">
    {% elif collection_type == 'github' %}
    <link rel="stylesheet" href="{% static 'collectibles/css/github.css' %}">
    {% elif collection_type == 'links' %}
    <link rel="stylesheet" href="{% static 'collectibles/css/links.css' %}">
    {% endif %}
</head>
<body>
    <!-- Messages -->
    {% if messages %}
    <div class="messages">
        {% for message in messages %}
        <div class="message {{ message.tags }}" onclick="this.style.display='none'">
            <div class="message-icon">
                {% if message.tags == 'success' %}‚úì{% elif message.tags == 'error' %}‚úï{% else %}‚ö†{% endif %}
            </div>
            <div class="message-text">{{ message }}</div>
        </div>
        {% endfor %}
    </div>
    {% endif %}

    <div class="collection-bar">
        <label for="collectionSelector">Collections</label>
        <select id="collectionSelector" class="collection-selector" onchange="switchCollection(this.value)">
            {% for option in collection_options %}
            <option value="{{ option.value }}" {% if collection_type == option.value %}selected{% endif %}>
                {{ option.label }}
            </option>
            {% endfor %}
        </select>
    </div>

    <div class="header">
        <div class="header-left">
            <h1>{{ current_meta.label }}</h1>
            <div class="video-count">{{ items.count }} {{ current_meta.item_label }}{{ items.count|pluralize }}</div>
        </div>
        <div class="view-toggle">
            <button class="view-btn" id="cardViewBtn" onclick="setView('card')">
                <div class="view-icon">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="3" y="3" width="7" height="7" rx="1"/>
                        <rect x="14" y="3" width="7" height="7" rx="1"/>
                        <rect x="3" y="14" width="7" height="7" rx="1"/>
                        <rect x="14" y="14" width="7" height="7" rx="1"/>
                    </svg>
                </div>
                <span>Cards</span>
            </button>
            <button class="view-btn active" id="listViewBtn" onclick="setView('list')">
                <div class="view-icon">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="8" y1="6" x2="21" y2="6"/>
                        <line x1="8" y1="12" x2="21" y2="12"/>
                        <line x1="8" y1="18" x2="21" y2="18"/>
                        <line x1="3" y1="6" x2="3.01" y2="6"/>
                        <line x1="3" y1="12" x2="3.01" y2="12"/>
                        <line x1="3" y1="18" x2="3.01" y2="18"/>
                    </svg>
                </div>
                <span>List</span>
            </button>
        </div>
    </div>

    <div class="container">
        <div class="video-list list-view {% if collection_type == 'twitter' %}twitter-list{% endif %}" id="videoList" data-collection-type="{{ collection_type }}">
            {% if collection_type == 'youtube' %}
                {% for video in items %}
                <div class="video-item">
                    <a href="{{ video.video_url }}" target="_blank" style="display: flex; gap: 16px; flex: 1; text-decoration: none; color: inherit;">
                        <div class="thumbnail-wrapper">
                            <img src="{{ video.thumbnail_url }}" alt="{{ video.title }}" class="thumbnail">
                            <div class="play-overlay">
                                <div class="play-icon"></div>
                            </div>
                        </div>
                        <div class="video-info">
                            <div class="video-title">{{ video.title }}</div>
                            <div class="video-id">{{ video.video_id }}</div>
                        </div>
                    </a>
                    <div class="video-actions">
                        <form method="POST" action="{% url 'video_resync' video.id %}" style="display: inline;">
                            {% csrf_token %}
                            <button type="submit" class="action-btn resync" onclick="return confirm('Resync video information?');">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M21 12a9 9 0 01-9 9m9-9a9 9 0 00-9-9m9 9H3m9 9a9 9 0 01-9-9m9 9c1.657 0 3-4.03 3-9s-1.343-9-3-9m0 18c-1.657 0-3-4.03-3-9s1.343-9 3-9m-9 9a9 9 0 019-9"/>
                                </svg>
                                Resync
                            </button>
                        </form>
                        <form method="POST" action="{% url 'video_delete' video.id %}" style="display: inline;">
                            {% csrf_token %}
                            <button type="submit" class="action-btn delete" onclick="return confirm('Are you sure you want to delete this video?');">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
                                </svg>
                                Delete
                            </button>
                        </form>
                    </div>
                </div>
                {% empty %}
                <div class="empty-state">
                    <div class="empty-state-icon">{{ current_meta.empty_icon }}</div>
                    <div class="empty-state-text">{{ current_meta.empty_text }}</div>
                </div>
                {% endfor %}

            {% elif collection_type == 'twitter' %}
                {% for post in items %}
                <div class="video-item tweet-card" data-post-id="{{ post.id }}">
                    <div class="tweet-container">
                        <blockquote class="twitter-tweet" data-theme="dark" data-dnt="true" data-conversation="none">
                            <p lang="en" dir="ltr">{{ post.text }}</p>
                            &mdash; {{ post.author_name }} (@{{ post.author_handle }})
                            <a href="{{ post.embed_url }}">View on X</a>
                        </blockquote>
                    </div>
                    <div class="video-actions">
                        <form method="POST" action="{% url 'twitter_resync' post.id %}" style="display: inline;">
                            {% csrf_token %}
                            <button type="submit" class="action-btn resync" onclick="return confirm('Resync post information?');">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M21 12a9 9 0 01-9 9m9-9a9 9 0 00-9-9m9 9H3m9 9a9 9 0 01-9-9m9 9c1.657 0 3-4.03 3-9s-1.343-9-3-9m0 18c-1.657 0-3-4.03-3-9s1.343-9 3-9m-9 9a9 9 0 019-9"/>
                                </svg>
                                Resync
                            </button>
                        </form>
                        <form method="POST" action="{% url 'twitter_delete' post.id %}" style="display: inline;">
                            {% csrf_token %}
                            <button type="submit" class="action-btn delete" onclick="return confirm('Are you sure you want to delete this post?');">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
                                </svg>
                                Delete
                            </button>
                        </form>
                    </div>
                </div>
                {% empty %}
                <div class="empty-state">
                    <div class="empty-state-icon">{{ current_meta.empty_icon }}</div>
                    <div class="empty-state-text">{{ current_meta.empty_text }}</div>
                </div>
                {% endfor %}

            {% elif collection_type == 'arxiv' %}
                {% for paper in items %}
                <div class="video-item paper-item">
                    <div class="paper-header">
                        <div>
                            <div class="paper-id">{{ paper.arxiv_id }}</div>
                            <div class="paper-title">{{ paper.title }}</div>
                            <div class="paper-authors">{{ paper.authors }}</div>
                        </div>
                        <a class="paper-link" href="{{ paper.paper_url }}" target="_blank">View on arXiv</a>
                    </div>
                    <p class="paper-summary">{% if paper.summary %}{{ paper.summary }}{% else %}No summary available yet.{% endif %}</p>
                    <div class="video-actions">
                        <form method="POST" action="{% url 'arxiv_resync' paper.id %}" style="display: inline;">
                            {% csrf_token %}
                            <button type="submit" class="action-btn resync" onclick="return confirm('Resync arXiv metadata?');">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M21 12a9 9 0 01-9 9m9-9a9 9 0 00-9-9m9 9H3m9 9a9 9 0 01-9-9m9 9c1.657 0 3-4.03 3-9s-1.343-9-3-9m0 18c-1.657 0-3-4.03-3-9s1.343-9 3-9m-9 9a9 9 0 019-9"/>
                                </svg>
                                Resync
                            </button>
                        </form>
                        <form method="POST" action="{% url 'arxiv_delete' paper.id %}" style="display: inline;">
                            {% csrf_token %}
                            <button type="submit" class="action-btn delete" onclick="return confirm('Delete this paper?');">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
                                </svg>
                                Delete
                            </button>
                        </form>
                    </div>
                </div>
                {% empty %}
                <div class="empty-state">
                    <div class="empty-state-icon">{{ current_meta.empty_icon }}</div>
                    <div class="empty-state-text">{{ current_meta.empty_text }}</div>
                </div>
                {% endfor %}

            {% elif collection_type == 'github' %}
                {% for repo in items %}
                <div class="video-item repo-item">
                    <div class="repo-header">
                        <a class="repo-name" href="{{ repo.repo_url }}" target="_blank">{{ repo.full_name }}</a>
                        <div class="repo-stars">‚≠ê {{ repo.stars }}</div>
                    </div>
                    <div class="repo-description">{% if repo.description %}{{ repo.description }}{% else %}No description provided.{% endif %}</div>
                    <div class="repo-meta">
                        {% if repo.language %}
                        <span>{{ repo.language }}</span>
                        {% endif %}
                        {% if repo.homepage %}
                        <a href="{{ repo.homepage }}" target="_blank">üîó {{ repo.homepage }}</a>
                        {% endif %}
                    </div>
                    <div class="video-actions">
                        <form method="POST" action="{% url 'github_resync' repo.id %}" style="display: inline;">
                            {% csrf_token %}
                            <button type="submit" class="action-btn resync" onclick="return confirm('Resync repository info?');">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M21 12a9 9 0 01-9 9m9-9a9 9 0 00-9-9m9 9H3m9 9a9 9 0 01-9-9m9 9c1.657 0 3-4.03 3-9s-1.343-9-3-9m0 18c-1.657 0-3-4.03-3-9s1.343-9 3-9m-9 9a9 9 0 019-9"/>
                                </svg>
                                Resync
                            </button>
                        </form>
                        <form method="POST" action="{% url 'github_delete' repo.id %}" style="display: inline;">
                            {% csrf_token %}
                            <button type="submit" class="action-btn delete" onclick="return confirm('Delete this repository?');">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
                                </svg>
                                Delete
                            </button>
                        </form>
                    </div>
                </div>
                {% empty %}
                <div class="empty-state">
                    <div class="empty-state-icon">{{ current_meta.empty_icon }}</div>
                    <div class="empty-state-text">{{ current_meta.empty_text }}</div>
                </div>
                {% endfor %}

            {% elif collection_type == 'links' %}
                {% for link in items %}
                <div class="video-item link-item">
                    <div class="link-header">
                        <div style="flex: 1;">
                            <a class="link-title" href="{{ link.link_url }}" target="_blank">{{ link.title }}</a>
                            <a class="link-url" href="{{ link.link_url }}" target="_blank">{{ link.url }}</a>
                        </div>
                    </div>
                    {% if link.description %}
                    <div class="link-description">{{ link.description }}</div>
                    {% endif %}
                    {% if link.tags %}
                    <div class="link-tags">
                        <span class="link-tag">{{ link.tags }}</span>
                    </div>
                    {% endif %}
                    <div class="video-actions">
                        <form method="POST" action="{% url 'link_resync' link.id %}" style="display: inline;">
                            {% csrf_token %}
                            <button type="submit" class="action-btn resync" onclick="return confirm('Resync link metadata?');">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M21 12a9 9 0 01-9 9m9-9a9 9 0 00-9-9m9 9H3m9 9a9 9 0 01-9-9m9 9c1.657 0 3-4.03 3-9s-1.343-9-3-9m0 18c-1.657 0-3-4.03-3-9s1.343-9 3-9m-9 9a9 9 0 019-9"/>
                                </svg>
                                Resync
                            </button>
                        </form>
                        <form method="POST" action="{% url 'link_delete' link.id %}" style="display: inline;">
                            {% csrf_token %}
                            <button type="submit" class="action-btn delete" onclick="return confirm('Delete this link?');">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
                                </svg>
                                Delete
                            </button>
                        </form>
                    </div>
                </div>
                {% empty %}
                <div class="empty-state">
                    <div class="empty-state-icon">{{ current_meta.empty_icon }}</div>
                    <div class="empty-state-text">{{ current_meta.empty_text }}</div>
                </div>
                {% endfor %}
            {% endif %}
        </div>
    </div>

    <!-- Add Item Button -->
    <button class="add-video-btn" onclick="openModal()" title="{{ current_meta.add_title }}">
        <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
            <line x1="12" y1="5" x2="12" y2="19"/>
            <line x1="5" y1="12" x2="19" y2="12"/>
        </svg>
    </button>

    <!-- Add Video Modal -->
    <div class="modal" id="addVideoModal" onclick="closeModalOnOutsideClick(event)">
        <div class="modal-content">
            <div class="modal-header">
                <h2>{{ current_meta.add_title }}</h2>
                <button class="close-btn" onclick="closeModal()" type="button">&times;</button>
            </div>
            <form method="POST">
                {% csrf_token %}
                <div class="form-group">
                    <label for="item_url">{{ current_meta.input_label }}</label>
                    <input
                        type="text"
                        id="item_url"
                        name="item_url"
                        placeholder="{{ current_meta.input_placeholder }}"
                        required
                        autofocus
                    >
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeModal()">Cancel</button>
                    <button type="submit" class="btn btn-primary">Add {{ current_meta.item_label|title }}</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Footer -->
    <footer>
        <a href="https://github.com/thelonejordan/mindtreelog" target="_blank">
            üîó github.com/thelonejordan/mindtreelog
        </a>
    </footer>

    <!-- Base JavaScript -->
    <script src="{% static 'collectibles/js/base.js' %}"></script>

    <!-- Twitter-specific JavaScript -->
    {% if collection_type == 'twitter' %}
    <script src="{% static 'collectibles/js/twitter.js' %}"></script>
    <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
    {% endif %}
</body>
</html>
